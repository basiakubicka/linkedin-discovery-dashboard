"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{670:function(e,t,o){o.r(t),o.d(t,{Checkout:()=>G});var r=o(9109),i=o(1102),n=o(1576),a=o(9888),l=o(9144),c=o(8e3),s=o(9082),d=o(3003),u=o(2464),m=o(4676),p=o(3799),h=o(9626),y=o(903);let f=(0,l.createContext)(null),g=()=>{let e=(0,l.useContext)(f);if(!e)throw Error("CheckoutContextRoot not found");return e},x=()=>{let{planId:e,planPeriod:t,subscriberType:o="user",onSubscriptionComplete:r}=(0,n.useCheckoutContext)(),i=(0,p.cL)(),{organization:a}=(0,p.o8)(),{user:c}=(0,p.aF)(),s={key:"commerce-checkout",userId:c?.id,arguments:{..."org"===o?{orgId:a?.id}:{},planId:e,planPeriod:t}},{data:d,mutate:u}=(0,h.default)(s),{trigger:m,isMutating:f,error:g}=(0,y.Z)(s,e=>i.billing?.startCheckout(e.arguments),{throwOnError:!1,onSuccess:e=>{u(e,!1)}});return(0,l.useEffect)(()=>(m(),()=>{u(void 0,!1)}),[]),{checkout:d,startCheckout:m,updateCheckout:e=>{u(e,!1),r?.()},isMutating:f,errors:g?.errors}},S=({children:e})=>{let{checkout:t,isMutating:o,updateCheckout:i,errors:n,startCheckout:a}=x(),c=(0,l.useMemo)(()=>{if(o)return"pending";let e="completed";if(t?.status===e)return e;if(t)return"ready";let r="missing_payer_email";if(n?.some(e=>e.code===r))return r;let i="invalid_plan_change";return n?.[0]?.code===i?i:"error"},[o,n,t,t?.status]);return(0,r.tZ)(f.Provider,{value:{checkout:t,isLoading:o,updateCheckout:i,errors:n,startCheckout:a,status:c},children:e})},b=({children:e,name:t})=>g().status!==t?null:e,k=e=>e[0].toUpperCase()+e.slice(1),$=(e,t,o)=>e+(t-e)*o,Z=()=>{let e=(0,m.useRouter)(),{setIsOpen:t}=(0,i.useDrawerContext)(),{newSubscriptionRedirectUrl:o}=(0,n.useCheckoutContext)(),{checkout:p}=g(),[h,y]=(0,l.useState)({x:256,y:256}),[f,x]=(0,l.useState)({x:256,y:256}),S=(0,l.useId)(),b=(0,l.useId)(),Z=(0,l.useId)(),B=(0,u.Tb)(),{animations:w}=(0,a.useAppearance)().parsedLayout,v=!B&&!0===w,C=(0,l.useRef)(null),D=(0,l.useRef)(null),z="undefined"==typeof window||window.matchMedia("(hover: hover) and (pointer: fine)").matches;return((0,l.useEffect)(()=>{if(!z)return;let e=()=>{x(e=>({x:$(e.x,h.x,.15),y:$(e.y,h.y,.15)})),C.current=requestAnimationFrame(e)};return C.current=requestAnimationFrame(e),()=>{C.current&&cancelAnimationFrame(C.current)}},[h,z]),p)?(0,r.BX)(r.HY,{children:[(0,r.tZ)(i.Drawer.Body,{children:(0,r.BX)(a.Span,{elementDescriptor:a.descriptors.checkoutSuccessRoot,sx:e=>({"--ring-fill":e.colors.$neutralAlpha200,"--ring-highlight":e.colors.$success500,margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",flexShrink:0,transformOrigin:"bottom center",animationName:"scaleIn",animationDuration:`${d.bf.slowest}ms`,animationTimingFunction:d.$$.bezier,animationFillMode:"forwards",opacity:0,overflow:"hidden",backgroundColor:e.colors.$colorBackground,"@keyframes scaleIn":{"0%":{filter:"blur(10px)",transform:"scale(0.85)",opacity:0},"100%":{filter:"blur(0px)",transform:"scale(1)",opacity:1}},...!v&&{animation:"none",opacity:1}}),ref:D,onMouseMove:e=>{if(z&&D.current){let t=D.current.getBoundingClientRect(),o=e.clientX-t.left,r=e.clientY-t.top,i=t.width;i>0?y({x:o/i*512,y:r/i*512}):y({x:256,y:256})}},children:[(0,r.BX)(a.Box,{elementDescriptor:a.descriptors.checkoutSuccessRings,as:"svg",viewBox:"0 0 512 512",sx:{position:"absolute",inset:0,pointerEvents:"none"},"aria-hidden":!0,children:[(0,r.BX)("defs",{children:[(0,r.BX)("radialGradient",{id:"clerk-checkout-success-gradient",children:[(0,r.tZ)("stop",{offset:"0%",style:{stopColor:"var(--ring-highlight)"}}),(0,r.tZ)("stop",{offset:"100%",stopOpacity:"0",style:{stopColor:"var(--ring-highlight)"}})]}),(0,r.tZ)("filter",{id:"clerk-checkout-success-blur-effect",children:(0,r.tZ)("feGaussianBlur",{stdDeviation:"10"})}),[{r:225,maskStart:10,maskEnd:90,id:S},{r:162.5,maskStart:15,maskEnd:85,id:b},{r:100,maskStart:20,maskEnd:80,id:Z}].map(({maskStart:e,maskEnd:t,id:o})=>(0,r.BX)("linearGradient",{id:`gradient-${o}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[(0,r.tZ)("stop",{offset:`${e+5}%`,stopColor:"white",stopOpacity:"0"}),(0,r.tZ)("stop",{offset:`${e+35}%`,stopColor:"white",stopOpacity:"1"}),(0,r.tZ)("stop",{offset:`${t-35}%`,stopColor:"white",stopOpacity:"1"}),(0,r.tZ)("stop",{offset:`${t-5}%`,stopColor:"white",stopOpacity:"0"})]},o)),(0,r.tZ)("mask",{id:"clerk-checkout-success-mask",children:[{r:225,id:S},{r:162.5,id:b},{r:100,id:Z}].map(({r:e,id:t})=>(0,r.tZ)("circle",{cx:"256",cy:"256",r:e,stroke:`url(#gradient-${t})`,fill:"none",strokeWidth:"1"},t))})]}),(0,r.BX)("g",{mask:"url(#clerk-checkout-success-mask)",children:[(0,r.tZ)("rect",{width:"512",height:"512",style:{fill:"var(--ring-fill)"}}),z&&(0,r.tZ)("rect",{id:"movingGradientHighlight",width:"256",height:"256",x:f.x-128,y:f.y-128,fill:"url(#clerk-checkout-success-gradient)",filter:"url(#clerk-checkout-success-blur-effect)"})]})]}),(0,r.BX)(a.Box,{elementDescriptor:a.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",color:z?e.colors.$success500:e.colors.$colorText,":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:[(0,r.tZ)("svg",{fill:"none",viewBox:"0 0 10 10","aria-hidden":"true",style:{position:"relative",margin:"auto",width:"1rem",height:"1rem"},children:(0,r.tZ)("path",{d:"m1 6 3 3 5-8",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"1",pathLength:"1",style:{strokeDashoffset:"1",animation:v?`check ${d.bf.drawer}ms ${d.$$.bezier} forwards ${d.bf.slow}ms`:"none",...!v&&{strokeDashoffset:"0"}}})}),(0,r.tZ)("style",{children:`
              @keyframes check {
                0% {
                  stroke-dashoffset: 1;
                }
                100% {
                  stroke-dashoffset: 0;
                }
            `})]}),(0,r.BX)(a.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:`translateY(${e.space.$20})`}),children:[(0,r.tZ)(a.Heading,{elementDescriptor:a.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:p.totals.totalDueNow.amount>0?(0,a.localizationKeys)("commerce.checkout.title__paymentSuccessful"):(0,a.localizationKeys)("commerce.checkout.title__subscriptionSuccessful"),sx:e=>({opacity:0,animationName:"slideUp",animationDuration:`${d.bf.slowest}ms`,animationTimingFunction:d.$$.bezier,animationFillMode:"forwards",color:e.colors.$colorText,"@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!v&&{opacity:1,animation:"none"}})}),(0,r.tZ)(a.Text,{elementDescriptor:a.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2,opacity:0,animationName:"slideUp",animationDuration:`${1.5*d.bf.slowest}ms`,animationTimingFunction:d.$$.bezier,animationFillMode:"forwards","@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!v&&{opacity:1,animation:"none"}}),localizationKey:p.totals.totalDueNow.amount>0?(0,a.localizationKeys)("commerce.checkout.description__paymentSuccessful"):(0,a.localizationKeys)("commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,r.BX)(i.Drawer.Footer,{sx:e=>({rowGap:e.space.$4,animationName:"footerSlideInUp",animationDuration:`${d.bf.drawer}ms`,animationTimingFunction:d.$$.bezier,"@keyframes footerSlideInUp":{"0%":{transform:"translateY(100%)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!v&&{animation:"none"}}),children:[(0,r.BX)(c.a.Root,{children:[(0,r.BX)(c.a.Group,{variant:"secondary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.checkout.lineItems.title__totalPaid")}),(0,r.tZ)(c.a.Description,{text:`${p.totals.totalDueNow.currencySymbol}${p.totals.totalDueNow.amountFormatted}`})]}),(0,r.BX)(c.a.Group,{variant:"secondary",children:[(0,r.tZ)(c.a.Title,{title:p.totals.totalDueNow.amount>0?(0,a.localizationKeys)("commerce.checkout.lineItems.title__paymentMethod"):(0,a.localizationKeys)("commerce.checkout.lineItems.title__subscriptionBegins")}),(0,r.tZ)(c.a.Description,{text:p.totals.totalDueNow.amount>0?p.paymentSource?"card"!==p.paymentSource.paymentMethod?`${k(p.paymentSource.paymentMethod)}`:`${k(p.paymentSource.cardType)} ⋯ ${p.paymentSource.last4}`:"–":p.planPeriodStart?(0,s.p)(new Date(p.planPeriodStart)):"–"})]})]}),(0,r.tZ)(a.Button,{onClick:()=>{o&&e.navigate(o),t&&t(!1)},localizationKey:(0,a.localizationKeys)("formButtonPrimary")})]})]}):null};var B=o(4455),w=o(2672),v=o(7291),C=o(3146),D=o(9732),z=o(8870),_=o(2189),K=o(4174),P=o(2083),R=o(7106);let T=e=>e[0].toUpperCase()+e.slice(1),A=(0,w.withCardStateProvider)(()=>{let{checkout:e}=g();if(!e)return null;let{plan:t,planPeriod:o,totals:n,isImmediatePlanChange:l}=e,s=!!n.credit?.amount&&n.credit.amount>0,d=!!n.pastDue?.amount&&n.pastDue.amount>0;return(0,r.BX)(i.Drawer.Body,{children:[(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.BX)(c.a.Root,{children:[(0,r.BX)(c.a.Group,{children:[(0,r.tZ)(c.a.Title,{title:t.name,description:"annual"===o?(0,a.localizationKeys)("commerce.billedAnnually"):void 0}),(0,r.tZ)(c.a.Description,{prefix:"annual"===o?"x12":void 0,text:`${t.currencySymbol}${"month"===o?t.amountFormatted:t.annualMonthlyAmountFormatted}`,suffix:(0,a.localizationKeys)("commerce.checkout.perMonth")})]}),(0,r.BX)(c.a.Group,{borderTop:!0,variant:"tertiary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.subtotal")}),(0,r.tZ)(c.a.Description,{text:`${n.subtotal.currencySymbol}${n.subtotal.amountFormatted}`})]}),s&&(0,r.BX)(c.a.Group,{variant:"tertiary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.creditRemainder")}),(0,r.tZ)(c.a.Description,{text:`- ${n.credit?.currencySymbol}${n.credit?.amountFormatted}`})]}),d&&(0,r.BX)(c.a.Group,{variant:"tertiary",children:[(0,r.BX)(D.u.Root,{children:[(0,r.tZ)(D.u.Trigger,{children:(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.pastDue"),icon:K.I$})}),(0,r.tZ)(D.u.Content,{text:(0,a.localizationKeys)("commerce.checkout.pastDueNotice")})]}),(0,r.tZ)(c.a.Description,{text:`${n.pastDue?.currencySymbol}${n.pastDue?.amountFormatted}`})]}),(0,r.BX)(c.a.Group,{borderTop:!0,children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.totalDueToday")}),(0,r.tZ)(c.a.Description,{text:`${n.totalDueNow.currencySymbol}${n.totalDueNow.amountFormatted}`})]})]})}),!l&&(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({paddingBlockStart:e.space.$4,paddingInline:e.space.$4}),children:(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("commerce.checkout.downgradeNotice"),variant:"caption",colorScheme:"secondary"})}),(0,r.tZ)(F,{checkout:e})]})}),X=()=>{let{organization:e}=(0,p.o8)(),{subscriberType:t}=(0,n.useCheckoutContext)(),{updateCheckout:o,checkout:r}=g(),i=(0,w.useCardState)();if(!r)throw Error("Checkout not found");let a=async n=>{i.setLoading(),i.setError(void 0);try{let i=await r.confirm({...n,..."org"===t?{orgId:e?.id}:{}});o(i)}catch(e){(0,z.S3)(e,[],i.setError)}finally{i.setIdle()}};return{payWithExistingPaymentSource:e=>(e.preventDefault(),a({paymentSourceId:new FormData(e.currentTarget).get("payment_source_id")})),addPaymentSourceAndPay:e=>a(e),payWithTestCard:async()=>{i.setLoading(),i.setError(void 0);try{let i=await r.confirm({gateway:"stripe",useTestCard:!0,..."org"===t?{orgId:e?.id}:{}});o(i)}catch(e){(0,z.S3)(e,[],i.setError)}finally{i.setIdle()}}}},F=({checkout:e})=>{let{data:t}=(0,n.usePaymentMethods)(),[o,i]=(0,l.useState)(()=>t.length>0?"existing":"new");return(0,r.BX)(a.Col,{elementDescriptor:a.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[t.length>0&&e.totals.totalDueNow.amount>0&&(0,r.BX)(v.s.Root,{"aria-label":"Payment method source",value:o,onChange:e=>i(e),size:"lg",fullWidth:!0,children:[(0,r.tZ)(v.s.Button,{value:"existing",text:(0,a.localizationKeys)("commerce.paymentMethods")}),(0,r.tZ)(v.s.Button,{value:"new",text:(0,a.localizationKeys)("commerce.addPaymentMethod")})]}),"existing"===o&&(0,r.tZ)(E,{checkout:e,paymentSources:t,totalDueNow:e.totals.totalDueNow}),"new"===o&&(0,r.tZ)(L,{})]})},I=()=>{let{isLoading:e}=(0,w.useCardState)(),{payWithTestCard:t}=X();return(0,r.BX)(a.Box,{sx:e=>({background:e.colors.$neutralAlpha50,padding:e.space.$2x5,borderRadius:e.radii.$md,borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$neutralAlpha100,display:"flex",flexDirection:"column",rowGap:e.space.$2,position:"relative"}),children:[(0,r.tZ)(a.Box,{sx:e=>({position:"absolute",inset:0,background:`repeating-linear-gradient(-45deg,${e.colors.$warningAlpha100},${e.colors.$warningAlpha100} 6px,${e.colors.$warningAlpha150} 6px,${e.colors.$warningAlpha150} 12px)`,maskImage:"linear-gradient(transparent 20%, black)",pointerEvents:"none"})}),(0,r.BX)(a.Flex,{sx:e=>({alignItems:"center",justifyContent:"center",flexDirection:"column",rowGap:e.space.$2}),children:[(0,r.tZ)(a.Text,{sx:e=>({color:e.colors.$warning500,fontWeight:e.fontWeights.$semibold}),localizationKey:(0,a.localizationKeys)("commerce.paymentSource.dev.developmentMode")}),(0,r.tZ)(a.Button,{type:"button",block:!0,variant:"bordered",localizationKey:(0,a.localizationKeys)("userProfile.billingPage.paymentSourcesSection.payWithTestCardButton"),colorScheme:"secondary",isLoading:e,onClick:t})]})]})},L=(0,w.withCardStateProvider)(()=>{let{addPaymentSourceAndPay:e}=X(),{checkout:t}=g();return t?(0,r.BX)(P.fC,{onSuccess:e,checkout:t,children:[(0,r.tZ)(_.P,{children:(0,r.tZ)(I,{})}),t.totals.totalDueNow.amount>0?(0,r.tZ)(P.OL,{text:(0,a.localizationKeys)("commerce.pay",{amount:`${t.totals.totalDueNow.currencySymbol}${t.totals.totalDueNow.amountFormatted}`})}):(0,r.tZ)(P.OL,{text:(0,a.localizationKeys)("commerce.subscribe")})]}):null}),E=(0,w.withCardStateProvider)(({checkout:e,totalDueNow:t,paymentSources:o})=>{let{payWithExistingPaymentSource:i}=X(),n=(0,w.useCardState)(),[c,s]=(0,l.useState)(e.paymentSource||o.find(e=>e.isDefault)),d=(0,l.useMemo)(()=>o.map(e=>{let t="card"!==e.paymentMethod?`${T(e.paymentMethod)}`:`${T(e.cardType)} ⋯ ${e.last4}`;return{value:e.id,label:t}}),[o]);return(0,r.BX)(a.Form,{onSubmit:i,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),children:[e.totals.totalDueNow.amount>0?(0,r.BX)(C.Ph,{elementId:"paymentSource",options:d,value:c?.id||null,onChange:e=>{s(o.find(t=>t.id===e.value))},portal:!0,children:[(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:c?.id}),(0,r.tZ)(C.UN,{icon:K.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:c&&(0,r.tZ)(R.j,{paymentSource:c})}),(0,r.tZ)(C.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}):(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:c?.id}),(0,r.tZ)(B.Z.Alert,{children:n.error}),(0,r.tZ)(a.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:n.isLoading,children:(0,r.tZ)(a.Text,{localizationKey:t.amount>0?(0,a.localizationKeys)("commerce.pay",{amount:`${t.currencySymbol}${t.amountFormatted}`}):(0,a.localizationKeys)("commerce.subscribe")})})]})});var M=o(9117),j=o(9140);let N=()=>{let{errors:e}=g(),{translateError:t}=(0,a.useLocalizations)(),{t:o}=(0,a.useLocalizations)();return(0,r.tZ)(i.Drawer.Body,{children:(0,r.tZ)(a.Flex,{align:"center",justify:"center",sx:e=>({height:"100%",padding:e.space.$4,fontSize:e.fontSizes.$md}),children:(0,r.tZ)(M.b,{variant:"danger",colorScheme:"danger",children:e?t(e[0]):o((0,a.localizationKeys)("unstable__errors.form_param_value_invalid"))})})})},W=()=>{let{errors:e}=g(),t=(0,l.useMemo)(()=>{let t=e?.find(e=>"invalid_plan_change"===e.code);return t?.meta?.plan},[e]),{planPeriod:o}=(0,n.useCheckoutContext)();return t?(0,r.tZ)(i.Drawer.Body,{children:(0,r.BX)(a.Flex,{gap:4,direction:"col",children:[(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.tZ)(c.a.Root,{children:(0,r.BX)(c.a.Group,{children:[(0,r.tZ)(c.a.Title,{title:t.name,description:"annual"===o?(0,a.localizationKeys)("commerce.billedAnnually"):void 0}),(0,r.tZ)(c.a.Description,{prefix:"annual"===o?"x12":void 0,text:`${t.currency_symbol}${"month"===o?t.amount_formatted:t.annual_monthly_amount_formatted}`,suffix:(0,a.localizationKeys)("commerce.checkout.perMonth")})]})})}),(0,r.tZ)(a.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(M.b,{variant:"info",colorScheme:"info",title:(0,a.localizationKeys)("commerce.cannotSubscribeMonthly")})})]})}):null},U=()=>{let{startCheckout:e}=g(),{setIsOpen:t}=(0,i.useDrawerContext)();return(0,r.tZ)(i.Drawer.Body,{children:(0,r.tZ)(a.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(j._,{title:(0,a.localizationKeys)("commerce.checkout.emailForm.title"),subtitle:(0,a.localizationKeys)("commerce.checkout.emailForm.subtitle"),onSuccess:e,onReset:()=>t(!1),disableAutoFocus:!0})})})},G=e=>(0,r.tZ)(a.Flow.Root,{flow:"checkout",children:(0,r.tZ)(a.Flow.Part,{children:(0,r.tZ)(n.SubscriberTypeContext.Provider,{value:e.subscriberType||"user",children:(0,r.tZ)(n.CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,r.BX)(i.Drawer.Content,{children:[(0,r.tZ)(i.Drawer.Header,{title:(0,a.localizationKeys)("commerce.checkout.title")}),(0,r.BX)(S,{children:[(0,r.tZ)(b,{name:"pending",children:(0,r.tZ)(a.Spinner,{sx:{margin:"auto"}})}),(0,r.tZ)(b,{name:"completed",children:(0,r.tZ)(Z,{})}),(0,r.tZ)(b,{name:"error",children:(0,r.tZ)(N,{})}),(0,r.tZ)(b,{name:"invalid_plan_change",children:(0,r.tZ)(W,{})}),(0,r.tZ)(b,{name:"missing_payer_email",children:(0,r.tZ)(U,{})}),(0,r.tZ)(b,{name:"ready",children:(0,r.tZ)(A,{})})]})]})})})})})},2083:function(e,t,o){o.d(t,{OL:()=>w,fC:()=>k,hG:()=>B,ph:()=>Z});var r=o(9109),i=o(3799),n=o(9144),a=o(4455),l=o(2672),c=o(431),s=o(9460),d=o(8487),u=o(8849),m=o(8870),p=o(1576),h=o(9888);let y=e=>{let t=(0,h.useAppearance)().parsedInternalTheme;return(0,n.useMemo)(()=>{if(!e)return;let{colors:o,fontWeights:r,fontSizes:i,radii:n,space:a}=t;return{colorPrimary:(0,u.Aj)(e,o.$primary500,o.$colorBackground),colorBackground:(0,u.Aj)(e,o.$colorInputBackground,o.$colorBackground),colorText:(0,u.Aj)(e,o.$colorText,o.$colorBackground),colorTextSecondary:(0,u.Aj)(e,o.$colorTextSecondary,o.$colorBackground),colorSuccess:(0,u.Aj)(e,o.$success500,o.$colorBackground),colorDanger:(0,u.Aj)(e,o.$danger500,o.$colorBackground),colorWarning:(0,u.Aj)(e,o.$warning500,o.$colorBackground),fontWeightNormal:(0,u.uj)(e,"font-weight",r.$normal.toString()),fontWeightMedium:(0,u.uj)(e,"font-weight",r.$medium.toString()),fontWeightBold:(0,u.uj)(e,"font-weight",r.$bold.toString()),fontSizeXl:(0,u.uj)(e,"font-size",i.$xl),fontSizeLg:(0,u.uj)(e,"font-size",i.$lg),fontSizeSm:(0,u.uj)(e,"font-size",i.$md),fontSizeXs:(0,u.uj)(e,"font-size",i.$sm),borderRadius:(0,u.uj)(e,"border-radius",n.$lg),spacingUnit:(0,u.uj)(e,"padding",a.$1)}},[t,e])},[f,g]=(0,i.uH)("AddPaymentSourceRoot"),x=({children:e,checkout:t,...o})=>{let a=(0,p.useSubscriberTypeContext)(),l=(0,n.useRef)(null),{t:c}=(0,h.useLocalizations)(),[s,d]=(0,n.useState)(void 0),[u,m]=(0,n.useState)(void 0),[g,x]=(0,n.useState)(void 0),S=y(l.current);return(0,r.BX)(f.Provider,{value:{value:{headerTitle:s,headerSubtitle:u,submitLabel:g,setHeaderTitle:d,setHeaderSubtitle:m,setSubmitLabel:x,checkout:t,...o}},children:[(0,r.tZ)("div",{ref:l,style:{display:"none"}}),(0,r.tZ)(i.pe,{checkout:t,for:a,stripeAppearance:S,paymentDescription:c((0,h.localizationKeys)(t?.planPeriod==="month"?"commerce.paymentSource.applePayDescription.monthly":"commerce.paymentSource.applePayDescription.annual")),children:e})]})},S=e=>{let{isProviderReady:t}=(0,i.Wh)();return t?null:e.children},b=e=>{let{isProviderReady:t}=(0,i.Wh)();return t?(0,r.tZ)(r.HY,{children:e.children}):null},k=e=>{let{children:t,...o}=e;return(0,r.BX)(x,{...o,children:[(0,r.tZ)(S,{children:(0,r.tZ)(h.Flex,{direction:"row",align:"center",justify:"center",sx:e=>({width:"100%",minHeight:e.sizes.$60}),children:(0,r.tZ)(h.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:h.descriptors.spinner})})}),(0,r.tZ)(b,{children:(0,r.tZ)(v,{children:t})})]})},$=(e,t)=>{(0,n.useRef)(()=>{t(e)}),(0,n.useEffect)(()=>{t(e)},[e,t])},Z=({text:e})=>{let{setHeaderTitle:t}=g();return $(e,t),null},B=({text:e})=>{let{setHeaderSubtitle:t}=g();return $(e,t),null},w=({text:e})=>{let{setSubmitLabel:t}=g();return $(e,t),null},v=({children:e})=>{let{headerTitle:t,headerSubtitle:o,submitLabel:n,checkout:u,onSuccess:y,cancelAction:f}=g(),x=(0,l.useCardState)(),S=(0,p.useSubscriberTypeLocalizationRoot)(),{isFormReady:b,submit:k,reset:$}=(0,i.Wh)(),Z=async e=>{e.preventDefault(),x.setLoading(),x.setError(void 0);let{data:t,error:o}=await k();if(!o)try{await y(t)}catch(e){(0,m.S3)(e,[],x.setError)}finally{x.setIdle(),$()}};return(0,r.tZ)(d.Y,{headerTitle:t,headerSubtitle:o,children:(0,r.BX)(c.l.Root,{onSubmit:Z,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$3}),children:[e,(0,r.tZ)(i.Y7,{}),(0,r.tZ)(a.Z.Alert,{children:x.error}),(0,r.tZ)(s.A,{isDisabled:!b,submitLabel:n??(0,h.localizationKeys)(`${S}.billingPage.paymentSourcesSection.formButtonPrimary__add`),onReset:f,hideReset:!f,sx:{flex:u?1:void 0}})]})})}},7106:function(e,t,o){o.d(t,{j:()=>a});var r=o(9109),i=o(9888),n=o(4174);let a=({paymentSource:e})=>(0,r.BX)(i.Flex,{sx:{overflow:"hidden"},gap:2,align:"baseline",elementDescriptor:i.descriptors.paymentSourceRow,children:[(0,r.tZ)(i.Icon,{icon:"card"===e.paymentMethod?n.aB:n.Nn,sx:{alignSelf:"center"},elementDescriptor:i.descriptors.paymentSourceRowIcon}),(0,r.tZ)(i.Text,{sx:e=>({color:e.colors.$colorText,textTransform:"capitalize"}),truncate:!0,elementDescriptor:i.descriptors.paymentSourceRowType,children:"card"===e.paymentMethod?e.cardType:e.paymentMethod}),(0,r.tZ)(i.Text,{sx:e=>({color:e.colors.$colorTextSecondary}),variant:"caption",truncate:!0,elementDescriptor:i.descriptors.paymentSourceRowValue,children:"card"===e.paymentMethod?`⋯ ${e.last4}`:null}),e.isDefault&&(0,r.tZ)(i.Badge,{elementDescriptor:i.descriptors.paymentSourceRowBadge,elementId:i.descriptors.paymentSourceRowBadge.setId("default"),localizationKey:(0,i.localizationKeys)("badge__default")}),"expired"===e.status&&(0,r.tZ)(i.Badge,{elementDescriptor:i.descriptors.paymentSourceRowBadge,elementId:i.descriptors.paymentSourceRowBadge.setId("expired"),colorScheme:"danger",localizationKey:(0,i.localizationKeys)("badge__expired")})]})},9140:function(e,t,o){o.d(t,{_:()=>$});var r=o(9109),i=o(3799),n=o(9144),a=o(2672),l=o(431),c=o(9460),s=o(8487),d=o(8870),u=o(6788),m=o(8969),p=o(1576),h=o(7703),y=o(207),f=o(4676),g=o(6917),x=o(9888),S=o(2464);let b=e=>{let{navigate:t}=(0,f.useRouter)(),{email:o,nextStep:i,onReset:l}=e,s=(0,a.useCardState)(),u=(0,p.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:m}=(0,S.eq)(o);async function h(){await t(o.verification.externalVerificationRedirectURL?.href||"")}return n.useEffect(()=>{!function(){let{mode:e,componentName:t}=u;m({redirectUrl:"modal"===e?(0,g.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>i()).catch(e=>(0,d.S3)(e,[],s.setError))}()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(x.Flex,{justify:"center",children:(0,r.tZ)(x.Button,{variant:"link",onClick:h,localizationKey:(0,x.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,r.tZ)(c.K,{children:(0,r.tZ)(x.Button,{variant:"ghost",localizationKey:(0,x.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:x.descriptors.formButtonReset,onClick:l})})]})};var k=o(2786);let $=(0,a.withCardStateProvider)(e=>{let{emailId:t,onSuccess:o,onReset:f,disableAutoFocus:g=!1}=e,x=(0,a.useCardState)(),{user:S}=(0,i.aF)(),$=(0,p.useEnvironment)(),w=(0,i.WZ)(e=>S?.createEmailAddress({email:e})),v=n.useRef(S?.emailAddresses.find(e=>e.id===t)),C=B(v.current,$),D=(0,m.a2)({defaultStep:+!!v.current,onNextStep:()=>x.setError(void 0)}),z=(0,u.Yp)("emailAddress","",{type:"email",label:(0,h.u1)("formFieldLabel__emailAddress"),placeholder:(0,h.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),_=z.value.length>1&&S?.username!==z.value,K=async e=>{if(e.preventDefault(),S)return w(z.value).then(e=>{v.current=e,D.nextStep()}).catch(e=>(0,d.S3)(e,[z],x.setError))},P=Z(C);return(0,r.BX)(m.en,{...D.props,children:[(0,r.tZ)(s.Y,{headerTitle:e.title||(0,h.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,h.u1)("userProfile.emailAddressPage.formHint"),children:(0,r.BX)(l.l.Root,{onSubmit:K,children:[(0,r.tZ)(l.l.ControlRow,{elementId:z.id,children:(0,r.tZ)(l.l.PlainInput,{...z.props,autoFocus:!g})}),(0,r.tZ)(c.A,{submitLabel:(0,h.u1)("userProfile.formButtonPrimary__add"),isDisabled:!_,onReset:f})]})}),(0,r.BX)(s.Y,{headerTitle:(0,h.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,h.u1)(`${P}.formSubtitle`,{identifier:v.current?.emailAddress||""}),children:["email_link"===C&&(0,r.tZ)(k.K,{nextStep:o,email:v.current,onReset:f}),"email_code"===C&&(0,r.tZ)(y.H,{nextStep:o,identification:v.current,identifier:v.current?.emailAddress,prepareVerification:()=>v.current?.prepareVerification({strategy:"email_code"}),onReset:f}),"enterprise_sso"===C&&(0,r.tZ)(b,{nextStep:o,email:v.current,onReset:f})]})]})}),Z=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error(`Unsupported strategy for email verification: ${e}`)}},B=(e,t)=>e?.matchesSsoConnection?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:o}=t.attributes;return!!(o?.enabled&&o?.verifications.includes("email_link"))}(t)?"email_code":"email_link"},207:function(e,t,o){o.d(t,{H:()=>u});var r=o(9109),i=o(9144),n=o(2667),a=o(2672),l=o(431),c=o(9460),s=o(8870),d=o(9888);let u=e=>{let t=(0,a.useCardState)(),{nextStep:o,identification:u,identifier:m,onReset:p,prepareVerification:h}=e,y=()=>h?.()?.catch(e=>s.S3(e,[],t.setError)),f=(0,n.e3)({onCodeEntryFinished:(e,t,o)=>{u?.attemptVerification({code:e}).then(()=>t()).catch(o)},onResendCodeClicked:y,onResolve:o});return i.useEffect(()=>{y()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(l.l.OTPInput,{...f,label:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:m||""}),resendButton:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,r.BX)(c.K,{children:[(0,r.tZ)(d.Button,{isLoading:f.isLoading,localizationKey:(0,d.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:d.descriptors.formButtonPrimary,onClick:f.onFakeContinue}),(0,r.tZ)(d.Button,{variant:"ghost",isDisabled:f.isLoading,localizationKey:(0,d.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:d.descriptors.formButtonReset,onClick:p})]})]})}},2786:function(e,t,o){o.d(t,{K:()=>h,M:()=>y});var r=o(9109),i=o(9144),n=o(2672),a=o(9460),l=o(5495),c=o(8870),s=o(8969),d=o(6749),u=o(1576),m=o(9888),p=o(2464);let h=e=>{let{email:t,nextStep:o,onReset:s}=e,h=(0,n.useCardState)(),y=(0,u.useUserProfileContext)(),{startEmailLinkFlow:f}=(0,p.E2)(t),{displayConfig:g}=(0,u.useEnvironment)();function x(){let{routing:e}=y,t="virtual"===e?g.userProfileUrl:"";f({redirectUrl:(0,d.Uu)({ctx:y,baseUrl:t,intent:"profile"})}).then(()=>o()).catch(e=>(0,c.S3)(e,[],h.setError))}return i.useEffect(()=>{x()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(l.V,{resendButton:(0,m.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:x}),(0,r.tZ)(a.K,{children:(0,r.tZ)(m.Button,{variant:"ghost",localizationKey:(0,m.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:m.descriptors.formButtonReset,onClick:s})})]})},y=()=>(0,r.tZ)(s.Ej,{title:(0,m.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,m.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);